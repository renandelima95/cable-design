<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cable Design Tool - Wire Bundle</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <!-- Modal de Edição -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-close" onclick="App.closeEditModal()">&times;</span>
                Editar Rota
            </div>
            <div class="input-group">
                <div class="input-row">
                    <label for="editCableType">Tipo de Cabo</label>
                    <select id="editCableType">
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="input-row">
                    <label for="editQuantity">Quantidade de Vias</label>
                    <input type="number" id="editQuantity" min="1" value="1">
                </div>
                <div class="input-row-2col">
                    <div>
                        <label for="editOrigin">Origem</label>
                        <select id="editOrigin">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div>
                        <label for="editDestination">Destino</label>
                        <select id="editDestination">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="App.saveEditedRoute()">Salvar Alterações</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-inner">
            <img src="assets/images/ares_logo.png" alt="ARES Logo" class="header-logo">
            <div class="header-text">
                <h1>Cable Design Tool</h1>
                <p>Designed by System Engineering</p>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- SECTION 1: GRAPHICAL EDITOR -->
        <div class="section">
            <div class="section-header">Editor Gráfico de Topologia</div>
            <div class="section-content">
                <div class="info-box">
                    <strong>Como usar:</strong>
                    1. Selecione o tipo de nó (End Node ou Transition) e clique em "Adicionar Nó", depois clique no canvas |
                    2. Clique em "Conectar" e clique em dois nós para criar conexão |
                    3. Modo "Selecionar" permite arrastar nós |
                    4. Duplo-clique em um nó para deletá-lo
                </div>

                <div class="toolbar">
                    <button class="tool-btn active" id="addNodeBtn" onclick="App.setMode('addNode')">Adicionar Nó</button>
                    <button class="tool-btn" id="connectBtn" onclick="App.setMode('connect')">Conectar</button>
                    <button class="tool-btn" id="selectBtn" onclick="App.setMode('select')">Selecionar</button>

                    <div class="node-type-selector">
                        <button class="node-type-btn end-node active" id="endNodeBtn" onclick="App.setNodeType('end')">End Node (J/P)</button>
                        <button class="node-type-btn transition-node" id="transitionNodeBtn" onclick="App.setNodeType('transition')">Transition (TB)</button>
                    </div>

                    <button class="btn btn-danger" onclick="CanvasEditor.clearCanvas()">Limpar Canvas</button>
                </div>

                <canvas id="canvas"></canvas>

                <div class="canvas-legend">
                    <div class="legend-item">
                        <div class="legend-dot end-node"></div>
                        <span>End Node (Jx / Px)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot transition-node"></div>
                        <span>Transition Node (TBx)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: DEFINE ROUTES -->
        <div class="section">
            <div class="section-header">Definir Rotas de Cabos</div>
            <div class="section-content">
                <div class="routes-grid">
                    <!-- Inputs -->
                    <div>
                        <h3 class="section-title">Adicionar Nova Rota</h3>

                        <div class="margin-control">
                            <label for="marginInput">Margem de Segurança (%)</label>
                            <input type="number" id="marginInput" value="10" min="0" max="50" step="1">
                        </div>

                        <div class="input-group">
                            <div class="input-row">
                                <label for="cableType">Tipo de Cabo</label>
                                <select id="cableType">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>

                            <div class="input-row">
                                <label for="quantity">Quantidade de Vias</label>
                                <input type="number" id="quantity" placeholder="1" min="1" value="1" step="1">
                            </div>

                            <div class="input-row-2col">
                                <div>
                                    <label for="origin">Origem</label>
                                    <select id="origin">
                                        <option value="">Selecione...</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="destination">Destino</label>
                                    <select id="destination">
                                        <option value="">Selecione...</option>
                                    </select>
                                </div>
                            </div>

                            <button class="btn btn-primary" onclick="App.addRoute()">Adicionar Rota (Auto-Roteamento)</button>
                        </div>
                    </div>

                    <!-- Defined Routes -->
                    <div>
                        <h3 class="section-title">Rotas Definidas</h3>
                        <div id="routesList">
                            <div class="empty-state">
                                <p>Nenhuma rota definida</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: RESULTS -->
        <div class="section">
            <div class="section-header">Comprimento Total por Tipo de Cabo</div>
            <div class="section-content">
                <div id="resultsContainer" class="results-grid">
                    <div class="empty-state">
                        <p>Adicione rotas para ver os resultados</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 4: WIRE BUNDLE PER RAMIFICATION -->
        <div class="section">
            <div class="section-header">Wire Bundle por Ramificação</div>
            <div class="section-content">
                <div id="bundleContainer">
                    <div class="empty-state">
                        <p>Adicione rotas para ver os wire bundles</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 5: CONNECTOR CONFIGURATION (END NODES) -->
        <div class="section">
            <div class="section-header">Configuração de Conectores (End Nodes)</div>
            <div class="section-content">
                <div class="info-box">
                    <strong>Configuração por End Node:</strong>
                    Para cada End Node (Jx/Px), selecione o conector, ângulo do backshell e tipo de boot shrink.
                    O sistema irá sugerir automaticamente o backshell e boot shrink adequados com base nos diâmetros.
                </div>
                <div id="connectorConfigContainer">
                    <div class="empty-state">
                        <p>Adicione End Nodes (Jx/Px) para configurar conectores</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 6: BILL OF MATERIALS -->
        <div class="section">
            <div class="section-header">Bill of Materials</div>
            <div class="section-content">
                <div id="bomContainer">
                    <div class="empty-state">
                        <p>Adicione rotas para ver a lista de materiais</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="section">
            <div class="section-content">
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="ExportManager.exportResults()">Exportar Resultados (CSV)</button>
                    <button class="btn btn-success" onclick="ExportManager.exportToVisio()">Exportar Visio (VSDX)</button>
                    <button class="btn btn-success" onclick="ExportManager.saveProject()">Salvar Projeto Completo</button>
                    <button class="btn btn-success" onclick="document.getElementById('loadProjectInput').click()">Carregar Projeto</button>
                    <input type="file" id="loadProjectInput" accept=".json" style="display: none;" onchange="ExportManager.loadProject(event)">
                    <button class="btn btn-danger" onclick="App.clearAll()">Limpar Todas as Rotas</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Core modules (loaded first) -->
    <script src="js/database.js"></script>

    <!-- Data files (populate Database arrays) -->
    <script src="data/cables.js"></script>
    <script src="data/braid_tubes.js"></script>
    <script src="data/tube_shrinks.js"></script>
    <script src="data/marker_sleeves.js"></script>
    <script src="data/clear_tube_shrinks.js"></script>
    <script src="data/connectors.js"></script>
    <script src="data/backshells.js"></script>
    <script src="data/boot_shrinks.js"></script>

    <!-- Application modules -->
    <script src="js/circle-packing.js"></script>
    <script src="js/routing.js"></script>
    <script src="js/components.js"></script>
    <script src="js/connectors.js"></script>
    <script src="js/bom.js"></script>
    <script src="js/export.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/app.js"></script>
    <script>
        App.init();
    </script>
</body>
</html>
